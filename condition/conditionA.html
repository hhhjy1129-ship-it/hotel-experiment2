<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Horizonte A</title>
<style>
  :root{--card-gap:16px}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#f8fafc;color:#1e293b}
  .topbar{position:sticky;top:0;z-index:60;background:#fff}
  .searchline{display:flex;gap:10px;padding:12px 16px;border-bottom:1px solid #eef2f7;align-items:center;overflow:auto}
  .pill{flex:0 0 auto;padding:10px 14px;border-radius:999px;border:1px solid #dbe3ee;background:#fff;font-weight:800;font-size:14px;color:#0f172a}
  .filters{display:flex;gap:10px;padding:10px 16px;border-bottom:1px solid #eef2f7;overflow:auto;white-space:nowrap;background:#fff}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid #dbe3ee;background:#fff;font-weight:700;font-size:14px}
  .chip.active{border-color:#0ea5e9;box-shadow:0 0 0 2px rgba(14,165,233,.15) inset}
  .wrap{max-width:1100px;margin:16px auto;padding:0 16px}
  .hotel{display:grid;grid-template-columns:320px 1fr 190px;gap:var(--card-gap);border:1px solid #e2e8f0;border-radius:16px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:12px}
  .hotel + .hotel{margin-top:14px}
  .imgwrap{position:relative;border-radius:12px;overflow:hidden}
  .img{width:100%;height:200px;object-fit:cover;display:block;background:#e5e7eb}
  .fav{position:absolute;right:10px;top:10px;width:38px;height:38px;border-radius:999px;border:1px solid #e2e8f0;background:#fff;display:grid;place-items:center;cursor:pointer}
  .fav::before{content:"\2661";color:#64748b;font-size:20px}
  .fav.active::before{content:"\2665";color:#ef4444}
  .title{font-size:22px;font-weight:900;margin:0 0 6px}
  .score{display:flex;align-items:center;gap:8px;color:#065f46}
  .dots{letter-spacing:1px}
  .meta{color:#64748b}
  .ranking{margin:8px 0;color:#b91c1c;font-weight:700;font-size:14px;border:1px solid #fca5a5;border-radius:6px;padding:4px 6px;display:inline-block}
  .bullets{margin:8px 0 0 0;padding:0 0 0 22px}
  .bullets li{margin:4px 0}
  .amenities{margin:6px 0 0 22px;display:flex;flex-wrap:wrap;gap:8px}
  .amenity-chip{padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#0f172a;font-size:13px;font-weight:700;border:1px solid #e2e8f0}
  .right{display:grid;align-content:center;justify-items:end;gap:8px}
  .price-badge{padding:.5rem .8rem;border-radius:999px;font-size:.95rem;font-weight:900;line-height:1;background:#16a34a;color:#fff}
  .buy-row{display:flex;align-items:center;gap:12px}
  .price .currency{font-weight:800;font-size:1.1rem}
  .price .amount{font-weight:900;font-size:1.9rem}
  .cta{background:#22c55e;color:#052e16;border:0;border-radius:999px;padding:12px 16px;font-weight:900;cursor:pointer}
  .cta[disabled]{opacity:.6;cursor:not-allowed}
</style>
</head>
<body>
  <div class="topbar">
    <div class="searchline"><div class="pill">入住 今天</div><div class="pill">退房 明天</div><div class="pill">1 客房 · 2 人</div></div>
    <div class="filters"><button class="chip active">价格</button><button class="chip">评分 4.5+</button></div>
  </div>

  <div class="wrap"><div id="list"></div></div>

<script>
  const GAS_URL = "https://script.google.com/macros/s/AKfycbx6gd_sXmyH0pwn15uu9-x_16eLSt83tUeSqradHue6DIiLPVEdoRgzoeSD8fgH1k83/exec";
  const CONDITION = 'A';
  const SAME_PRICE = 'US$301';
  const REVIEW_COUNT = 324;
  const RATING = '4.5';
  const UNIQUE_CODE = true;

  const HOTEL_A = { id:'A', name:'Palm Tree Inn', img:'hotel1.jpg', tags:['精品','古雅','浪漫'] };
  const HOTEL_B = { id:'B', name:'Rotex Western Inn', img:'hotel2.jpg', tags:['安静','舒适','便捷'] };

  const qs = new URLSearchParams(location.search);
  let seed = parseInt(qs.get('seed')||Date.now().toString().slice(-6),10);
  const subj = qs.get('subj') || '';
  const LOCK_KEY = subj ? `choice_lock_${subj}_${CONDITION}` : 'choice_lock_tmp';
  if(qs.get('reset')==='1'){ localStorage.removeItem(LOCK_KEY); sessionStorage.removeItem('choice_lock_tmp'); }

  function isLocked(){ try{ return JSON.parse(localStorage.getItem(LOCK_KEY)||sessionStorage.getItem(LOCK_KEY)||'null'); }catch(e){ return null; } }
  function setLock(payload){ localStorage.setItem(LOCK_KEY, JSON.stringify(payload)); }

  function genCodeUnique(){
    const a = new Uint32Array(2); crypto.getRandomValues(a);
    return ('H' + Date.now().toString(36) + a[0].toString(36).slice(-3) + a[1].toString(36).slice(-3)).toUpperCase().slice(0,10);
  }

  async function copy(text){ try{ await navigator.clipboard.writeText(text); }catch(e){} }

  function logClick(payload){
    const blob = new Blob([JSON.stringify(payload)], { type:"text/plain" });
    if(navigator.sendBeacon && navigator.sendBeacon(GAS_URL, blob)) return;
    fetch(GAS_URL,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(payload),keepalive:true}).catch(()=>{});
  }

  function makeCard(hotel){
    const el=document.createElement('div'); el.className='hotel';
    el.innerHTML=`
      <div class="imgwrap"><img class="img" src="${hotel.img}"><div class="fav"></div></div>
      <div class="mid"><h3 class="title">${hotel.name}</h3><div class="score"><span>${RATING}</span><span class="dots">●●●●●◐</span><span class="meta">（${REVIEW_COUNT} 条点评）</span></div></div>
      <div class="right"><span class="price-badge">过去30天内超低价</span>
        <div class="buy-row"><div class="price"><span class="currency">US$</span><span class="amount">301</span></div><button class="cta">点击购买</button></div>
      </div>`;
    el.querySelector('.cta').addEventListener('click',()=>{
      if(isLocked()){alert('您已提交过选择');return;}
      const hotelName=hotel.name; const isFuture=false;
      const code=genCodeUnique();
      setLock({subj,condition:CONDITION,hotelName,isFuture,code,ts:new Date().toISOString()});
      el.querySelector('.price-badge').textContent=`已记录，验证码：${code}`;
      document.querySelectorAll('.cta').forEach(btn=>btn.disabled=true);
      copy(code);
      logClick({subj,condition:CONDITION,hotel:hotelName,isFuture,code,seed,ts:Date.now()});
    });
    return el;
  }

  function render(){
    const list=document.getElementById('list');
    [HOTEL_A,HOTEL_B].forEach(h=>list.appendChild(makeCard(h)));
    const lock=isLocked(); if(lock){document.querySelectorAll('.cta').forEach(b=>b.disabled=true);}
  }
  render();
</script>
</body>
</html>

